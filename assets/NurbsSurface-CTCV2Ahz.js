import{j as B}from"./jsx-runtime-DiklIkkE.js";import{r as T}from"./index-DRjF_FHU.js";import{u as $,v as H,B as J,F as K,M as L,D as P,a as Q,b as V}from"./verb.es-vEISxjAU.js";function X({controlPoints:d,weights:j,degreeU:n,degreeV:s,color:x="#ffffff",wireframe:N=!1,children:i,...k}){const{scene:h}=$(),[M,C]=T.useState(null);return T.useEffect(()=>{const v=d.length+n+1,w=d[0].length+s+1,D=Array(v).fill(0).map((t,e)=>e<n+1?0:e>=v-n-1?1:(e-n)/(v-2*n-1)),F=Array(w).fill(0).map((t,e)=>e<s+1?0:e>=w-s-1?1:(e-s)/(w-2*s-1)),y=H.geom.NurbsSurface.byKnotsControlPointsWeights(n,s,D,F,d,j),r=new J,E=[],g=[],S=[],A=20,p=20,G=1/A,I=1/p;for(let t=0;t<=A;t++)for(let e=0;e<=p;e++){const o=t*G,a=e*I,f=y.point(o,a),m=1e-4,R=y.point(o+m,a),z=y.point(o,a+m),_=y.point(o,a),c=R.map((b,q)=>(b-_[q])/m),l=z.map((b,q)=>(b-_[q])/m),u=[c[1]*l[2]-c[2]*l[1],c[2]*l[0]-c[0]*l[2],c[0]*l[1]-c[1]*l[0]],O=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]),W=u.map(b=>b/O);E.push(...f),g.push(...W)}for(let t=0;t<A;t++)for(let e=0;e<p;e++){const o=t*(p+1)+e,a=o+1,f=(t+1)*(p+1)+e,m=f+1;S.push(o,a,f),S.push(a,m,f)}if(r.setAttribute("position",new K(E,3)),r.setAttribute("normal",new K(g,3)),r.setIndex(S),C(r),!i){const t=new L({color:new Q(x),side:P,wireframe:N}),e=new V(r,t);return h.add(e),()=>{h.remove(e),r.dispose(),t.dispose()}}return()=>{r.dispose()}},[d,j,n,s,x,N,h,i]),M&&i?!T.isValidElement(i)||!i.type.toString().includes("Material")?(console.warn("NurbsSurface children must be a material component"),null):B.jsxs("mesh",{...k,children:[B.jsx("primitive",{object:M,attach:"geometry"}),i]}):null}X.__docgenInfo={description:"",methods:[],displayName:"NurbsSurface",props:{controlPoints:{required:!0,tsType:{name:"Array",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"}],raw:"number[][][]"},description:""},weights:{required:!0,tsType:{name:"Array",elements:[{name:"Array",elements:[{name:"number"}],raw:"number[]"}],raw:"number[][]"},description:""},degreeU:{required:!0,tsType:{name:"number"},description:""},degreeV:{required:!0,tsType:{name:"number"},description:""},color:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"#ffffff"',computed:!1}},wireframe:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},children:{required:!1,tsType:{name:"ReactElement"},description:""}},composes:["Omit"]};export{X as N};
